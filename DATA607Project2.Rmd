---
title: "DATA607 Project 2"
author: "Dhanya Nair"
date: "2024-03-02"
output: html_document
---
Dataset 1: Annual estimates of mean surface temperature change measured with respect to a baseline climatology

Analysis:
i cleaned the data, transformed and calculated the mean statistic.

Conclusion:
Based on this analysis, Luxemberg ,Estonia, Serbia,Belgium and latvia countries may be experiencing a more pronounced impact in terms of temperature change.

```{r}
library(dplyr,warn.conflicts = FALSE)
library(tidyr,warn.conflicts = FALSE)
library(readr,warn.conflicts = FALSE)


#read the csv file on Climate_Indicators_Annual_Mean_Global_Surface_Temperature
load <- read.csv('https://raw.githubusercontent.com/datanerddhanya/DATA607/main/Indicator_3_1_Climate_Indicators_Annual_Mean_Global_Surface_Temperature_577579683071085080.csv',sep = ",", stringsAsFactors=FALSE, quote = "\"")

#parse the data into a dataframe
#load<- data.frame(load)

# the data is wide as teh years are in the columns. i would like to tidy the data by moving it into #rows.
load_pivot <- load  %>%
  pivot_longer(
     cols = !(ObjectId:CTS.Full.Descriptor) ,
     names_to = "Year", 
     values_to = "Mean.Surface.Temp.change" ,
    values_drop_na = TRUE
   ) 

#need to split the Year column to remove the X value in it 
load_clean <- load_pivot |> 
   separate_wider_delim(Year, delim = "X", names = c("Blank", "Year"))
  
# cleaning up Country column to remove text after comma
  extract_value <- function(x) {
  if (grepl(",", x)) {
    split_values <- strsplit(x, ",")[[1]]
    return(trimws(split_values[1]))
  } else {
    return(trimws(x))
  }
  }

# Apply the function to the entire column
load_clean$Country <- sapply(load_clean$Country, extract_value)


 
#Create an new data frame with the required columns
load_final <- load_clean[,c('ObjectId','Country','ISO3','Unit','Year','Mean.Surface.Temp.change')]
# transform(load_final, Mean.Surface.Temp.change = as.numeric(Mean.Surface.Temp.change))
# load_final$Mean.Surface.Temp.change = as.numeric(load_final$Mean.Surface.Temp.change)


#Calculate average climate change over all the years for a country
load_climate_change <- load_final %>%
 group_by(Country) %>%
#summarise(across(everything(), list(mean))) %>%
  summarise( Mean.Surface.Temp.change = mean(Mean.Surface.Temp.change)) %>%
#  summarise(.funs = mean,na.rm=T)          
arrange(desc(Mean.Surface.Temp.change))

head(load_climate_change)

# calculate overall center and spread
mean = mean(load_climate_change$Mean.Surface.Temp.change)
sd= sd(load_climate_change$Mean.Surface.Temp.change)

#mean
head(mean)

#standard deviation
head(sd)
```
Dataset 2:Weather Data (by Institution): Average Temperature, Days of Precipitation, and Sunny Days

Analysis: 
To acquire the data, tidy, clean, transform and visualize the data

Conclusion:
1.I observed that few  of the institute like Ramapo College of New Jersey does not have a Avg temperature for few months.Hence had to use na.rm=true to remove them.
2.when visualized the avg mean temperature, through histogram its is multimodal distribution and is not symmetric.
3. i see a negative correlation between the two.lesser the precipitation, more are the sunny days.


```{r}

library(dplyr,warn.conflicts = FALSE)
library(tidyr,warn.conflicts = FALSE)
library(readr,warn.conflicts = FALSE)
library(ggplot2)
#i tried to scrape the data from the table displayed in the website, but i was not successful.

#read the csv file on Climate_Indicators_Annual_Mean_Global_Surface_Temperature
# i used file encoding to get the special character ° in the data.
raw <- read.csv('https://raw.githubusercontent.com/datanerddhanya/DATA607/main/Institutions_Weather_Data.csv', sep = ",", fileEncoding="latin1")

#Extract only the average high temperature for calculation purposes.
 raw <- raw |> 
 separate_wider_delim(Avg.Jan.Temp, delim = "°", names = c("Avg.Jan.Temp", "other"), too_many="drop") |>
 separate_wider_delim(Avg.April.Temp, delim = "°", names = c("Avg.April.Temp", "other1"), too_many="drop") |>
 separate_wider_delim(Avg.July.Temp, delim = "°", names = c("Avg.July.Temp", "other2"), too_many="drop") |>
 separate_wider_delim(Avg.Oct.Temp, delim = "°", names = c("Avg.Oct.Temp", "other3"), too_many="drop")

 # select the columns needed
 weather_data <- raw |> 
   select(!starts_with("other"))
 
 
 # convert from character to numeric
 weather_data$Avg.Jan.Temp = as.numeric(weather_data$Avg.Jan.Temp)
  weather_data$Avg.April.Temp = as.numeric(weather_data$Avg.April.Temp)
   weather_data$Avg.July.Temp = as.numeric(weather_data$Avg.July.Temp)
    weather_data$Avg.Oct.Temp = as.numeric(weather_data$Avg.Oct.Temp)
    
# now we can sort the temperatures, find the mean , generate new columns etc
# observed that one of the institute: Ramapo College of New Jersey does not have a temperature for april. Hence removing that row  
 head(weather_data)
 
 weather_data_stat <- weather_data |> 
   rowwise() |> 
  mutate( avg.temp = mean(c(Avg.Jan.Temp,Avg.April.Temp,Avg.July.Temp,Avg.Oct.Temp),na.rm = TRUE))
 
 #summarise data by state
 
 weather_data_stat_summary <- weather_data_stat %>%
 group_by(State) %>%
#summarise(across(everything(), list(mean))) %>%
  summarise( avg.state.temp = mean(avg.temp),avg.state.prec = mean(Days.w.Precipitation), avg.state.sunnydays = mean(Sunny.Days))
 
 
 # when visualized through historgram its is multimodal distrbution and is not symmetric.
  statemean = mean(weather_data_stat_summary$avg.state.temp)
  statesd = sd(weather_data_stat_summary$avg.state.temp)
 ggplot(weather_data_stat_summary, aes(avg.state.temp))+
   geom_histogram() +
    stat_function(fun = dnorm, args = c(mean = statemean , sd = statesd), col = "tomato")


 #checking if there is any correlation between precipitation and sunny days
 # i see a negative correlation between the two.lesser the precipation, more are the sunny days.
 ggplot(weather_data_stat_summary, aes(avg.state.sunnydays,avg.state.prec))+
   geom_point() 
 

```

Dataset 3: 
New York City Air Quality Data

Analysis:
Compare air pollutants levels vs. locations vs. time of year.

Conclusion:
I can observe here that the pollution levels for Nitrogen dioxide (NO2) and Fine particles (PM 2.5) have decreased over the years.

Midtown(CD5) location has the highest pollution levels for Nitrogen dioxide (NO2) and Fine particles (PM 2.5) for 2021.
```{r}



library(dplyr,warn.conflicts = FALSE)
library(tidyr,warn.conflicts = FALSE)
library(readr,warn.conflicts = FALSE)
library(ggplot2)

#read the csv file 
pollutant_levels <- read.csv('https://raw.githubusercontent.com/datanerddhanya/DATA607/main/Air_Quality_20240302.csv', fileEncoding="latin1")

#select only the Annual Report time period category for analysis in Time.Period column
pollutant_levels_summary <- pollutant_levels[grep("Annual",pollutant_levels$Time.Period),] 

# cleanup Time.period variable to remove "Annual Report" and convert to numeric
pollutant_levels_summary$Time.Period <- gsub("Annual Average ", " ",pollutant_levels_summary$Time.Period) 


#Summarize to Pollutant and Year
pollutant_levels_name <- pollutant_levels_summary  |>
  group_by(Name,Time.Period) |>
  summarise(mean = mean(Data.Value))

#Summarize to Location and Year
pollutant_levels_location <- pollutant_levels_summary  |>
  group_by(Geo.Place.Name, Time.Period) |>
  summarise(mean = mean(Data.Value))

#Summarize to Location and Year
pollutant_levels_name_location <- pollutant_levels_summary  |>
  group_by(Name,Geo.Place.Name, Time.Period) |>
  summarise(mean = mean(Data.Value))


#Visualise using plots
# I can observe here that the pollution levels for Nitrogen dioxide (NO2) and Fine particles (PM 2.5) have decreased over the years.

ggplot(data =pollutant_levels_name, aes(Time.Period,mean) )+
  geom_col(aes(colour=Name))

#which city has the highest pollution levels of Nitrogen dioxide (NO2) and Fine particles (PM 2.5)
#for the year 2021

pollutant_levels_name_location[grepl("2021",pollutant_levels_name_location$Time.Period),] |>

arrange(desc(mean))

#Midtown(CD5) has the highest pollution levels for Nitrogen dioxide (NO2) and Fine particles (PM 2.5) for 2021.


```
